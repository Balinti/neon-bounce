<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Bounce - Free HTML5 Game</title>
<meta name="description" content="Play Neon Bounce - Tap to bounce a glowing ball between neon platforms. Miss a platform and fall into the void. Platforms get narrower as score increases.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0014">
<meta property="og:type" content="website">
<meta property="og:title" content="Neon Bounce - Free HTML5 Game">
<meta property="og:description" content="Tap to flip gravity and bounce a glowing ball between neon platforms. How high can you score?">
<meta property="og:url" content="https://balinti.github.io/neon-bounce/">
<meta property="og:image" content="https://balinti.github.io/neon-bounce/og.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Neon Bounce - Free HTML5 Game">
<meta name="twitter:description" content="Tap to flip gravity and bounce between neon platforms. How high can you score?">
<meta name="twitter:image" content="https://balinti.github.io/neon-bounce/og.jpg">
<link rel="canonical" href="https://balinti.github.io/neon-bounce/">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0a0014;font-family:'Segoe UI',system-ui,-apple-system,sans-serif}
body{display:flex;flex-direction:column;align-items:center;justify-content:center}
#gc{position:relative;width:100%;max-width:420px;max-height:750px;aspect-ratio:420/750;touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none}
canvas{display:block;width:100%;height:100%;border-radius:6px;cursor:pointer}
#seo{max-width:420px;width:100%;padding:6px 14px;color:#443366;font-size:11px;line-height:1.4;text-align:center;opacity:0.45}
#seo a{color:#665599;text-decoration:none}
@media(max-height:520px){#seo{display:none}}
</style>
</head>
<body>
<div id="gc"><canvas id="c"></canvas></div>
<div id="seo">
<p>Neon Bounce is a free hyper-casual HTML5 game. Tap to flip side-gravity and guide a glowing ball between neon wall-pads. Build combos with perfect landings, charge Neon Save, and climb the leaderboard. Works on mobile and desktop.</p>
</div>
<script>
'use strict';
(function(){

// ============ VIRTUAL RESOLUTION & CANVAS ============
const VW = 420, VH = 750;
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function resize(){
  const gc = document.getElementById('gc');
  const r = gc.getBoundingClientRect();
  const dpr = Math.min(window.devicePixelRatio||1, 3);
  canvas.width = Math.round(r.width * dpr);
  canvas.height = Math.round(r.height * dpr);
  canvas.style.width = r.width + 'px';
  canvas.style.height = r.height + 'px';
}
window.addEventListener('resize', resize);
resize();

// ============ CONSTANTS ============
const LS_KEY = 'nfb_highscore_v1';
const BALL_R = 11;
const GRAVITY_Y = 1650;
const SIDE_GRAV = 520;
const FLIP_IMPULSE = 260;
const LAUNCH_VY = -680;
const PAD_H = 14;
const PAD_W_MAX = 120;
const PAD_W_MIN = 58;
const PERFECT_FRAC = 0.28;
const WALL_L = 28;
const WALL_R_OFF = 28;
const PAD_INSET = 6;
const SPAWN_GAP_MAX = 175;
const SPAWN_GAP_MIN = 110;
const TRAIL_MAX = 14;
const MAX_PARTICLES = 280;
const RESULTS_PAUSE = 0.3;
const SAVE_SLOW_DUR = 0.7;
const SAVE_SNAP_SPD = 1100;

// ============ GAME STATE ============
const S = {START:0, PLAYING:1, OVER:2};
let state = S.START;
let score=0, best=0, combo=0, multi=1;
let hue=260, gameTime=0;
let shakeX=0, shakeY=0, shakeDur=0, shakeStr=0;
let flipShown=false, flipAlpha=0;
let overPause=0;
let challengeScore=0;
let shareFeedback=0;
let cameraY=0, targetCamY=0;

// ball
let bx=0, by=0, bvx=0, bvy=0, bside=1, bOnPad=false;

// neon save
let saveCharge=0, saveOn=false, saveTimer=0, savePad=null;

// collections
let pads=[], gates=[], trail=[];
let nextPadY=0, lastPadSide=0, padId=0;

// particle pool
const pool=[];
for(let i=0;i<MAX_PARTICLES;i++) pool.push({x:0,y:0,vx:0,vy:0,life:0,ml:0,sz:0,h:0,tp:0,active:false});

try{best=parseInt(localStorage.getItem(LS_KEY))||0}catch(e){}
try{
  const p=new URLSearchParams(location.search);
  const c=parseInt(p.get('challenge'));
  if(c>0) challengeScore=c;
}catch(e){}

// ============ HELPERS ============
function lerp(a,b,t){return a+(b-a)*t}
function rnd(a,b){return a+Math.random()*(b-a)}
function clamp(v,lo,hi){return v<lo?lo:v>hi?hi:v}

// ============ PARTICLE HELPERS ============
function emit(x,y,vx,vy,life,sz,h,tp){
  for(let i=0;i<pool.length;i++){
    const p=pool[i];
    if(!p.active){
      p.x=x;p.y=y;p.vx=vx;p.vy=vy;p.life=life;p.ml=life;p.sz=sz;p.h=h;p.tp=tp;p.active=true;
      return;
    }
  }
}
function emitSparks(x,y,n,h){
  for(let i=0;i<n;i++) emit(x+rnd(-12,12),y+rnd(-4,4),rnd(-140,140),rnd(-220,-30),rnd(0.3,0.7),rnd(2,5.5),h+rnd(-20,20),0);
}
function emitPerfect(x,y,h){
  for(let i=0;i<18;i++) emit(x+rnd(-8,8),y+rnd(-4,4),rnd(-200,200),rnd(-320,-60),rnd(0.4,0.95),rnd(3,7),h+rnd(-15,15),0);
  emit(x,y,0,0,0.55,6,h,1); // ring
}
function emitFlip(x,y,h){
  for(let i=0;i<7;i++) emit(x,y,rnd(-110,110),rnd(-110,110),rnd(0.2,0.45),rnd(2,4.5),h+rnd(-25,25),0);
}
function emitDeath(x,y,h){
  for(let i=0;i<30;i++) emit(x+rnd(-6,6),y+rnd(-6,6),rnd(-280,280),rnd(-350,-20),rnd(0.5,1.3),rnd(3,8),h+rnd(-35,35),0);
  emit(x,y,0,0,0.7,8,h,1);
  emit(x,y,0,0,0.5,5,(h+60)%360,1);
}

// ============ PAD CREATION ============
function wallR(){return VW-WALL_R_OFF}

function getPadW(){return lerp(PAD_W_MAX,PAD_W_MIN,getDiff()*0.65)}
function getGap(){return lerp(SPAWN_GAP_MAX,SPAWN_GAP_MIN,getDiff()*0.45)}
function getDiff(){return Math.min(score/75,1)}

function shouldMove(){return score>=10 && Math.random()<getDiff()*0.35}
function shouldGate(){return score>=18 && Math.random()<getDiff()*0.12}
function canRepeat(){return score>=6 && Math.random()<0.25+getDiff()*0.25}

function mkPad(x,y,w,side,moving){
  return{id:padId++,x:x,y:y,w:w,h:PAD_H,side:side,
    moving:moving,mSpd:moving?rnd(28,55+getDiff()*35):0,mDir:Math.random()<0.5?1:-1,
    mRange:rnd(18,45),baseY:y,scored:false,perfect:false};
}

function spawnNext(){
  const w=getPadW();
  let side;
  if(lastPadSide===0) side=Math.random()<0.5?-1:1;
  else if(canRepeat()) side=lastPadSide;
  else side=-lastPadSide;

  let x;
  if(side===-1) x=WALL_L+PAD_INSET;
  else x=wallR()-w-PAD_INSET;

  const mv=shouldMove();
  pads.push(mkPad(x,nextPadY,w,side,mv));
  lastPadSide=side;

  if(shouldGate()){
    const gy=nextPadY+getGap()*0.35;
    gates.push({x:VW/2-3,y:gy,w:6,h:rnd(55,95)});
  }
  nextPadY-=getGap();
}

// ============ INIT GAME ============
function initGame(){
  score=0;combo=0;multi=1;gameTime=0;
  hue=260;shakeX=0;shakeY=0;shakeDur=0;
  flipShown=false;flipAlpha=0;overPause=0;
  saveCharge=0;saveOn=false;saveTimer=0;savePad=null;
  shareFeedback=0;
  pads.length=0;gates.length=0;trail.length=0;
  for(let i=0;i<pool.length;i++) pool[i].active=false;
  padId=0;lastPadSide=0;

  // start pad center-ish
  const sp=mkPad(VW/2-55,VH-140,110,0,false);
  pads.push(sp);
  bx=sp.x+sp.w/2; by=sp.y-BALL_R;
  bvx=0;bvy=0;bside=1;bOnPad=true;

  nextPadY=sp.y-getGap();
  for(let i=0;i<10;i++) spawnNext();

  cameraY=0;targetCamY=0;
}

// ============ CAMERA ============
function updateCam(){
  targetCamY=Math.min(0,-(by-VH*0.42));
  cameraY=lerp(cameraY,targetCamY,0.09);
}

// ============ SHAKE ============
function shake(str,dur){shakeStr=str;shakeDur=dur}
function updateShake(dt){
  if(shakeDur>0){shakeDur-=dt;const t=clamp(shakeDur/0.15,0,1);shakeX=(Math.random()-0.5)*2*shakeStr*t;shakeY=(Math.random()-0.5)*2*shakeStr*t;}
  else{shakeX=0;shakeY=0;}
}

// ============ NEON SAVE ============
function findNearPad(){
  let best=null,bd=1e9;
  for(let i=0;i<pads.length;i++){
    const p=pads[i];
    if(p.scored) continue;
    const cy=p.y+p.h/2;
    if(cy<by-15){const d=Math.abs(cy-by);if(d<bd){bd=d;best=p;}}
  }
  return best;
}
function trySave(){
  if(saveCharge<1||saveOn) return false;
  const t=findNearPad();
  if(!t) return false;
  saveOn=true;saveTimer=SAVE_SLOW_DUR;savePad=t;saveCharge=0;
  return true;
}

// ============ INPUT ============
function doInput(){
  if(state===S.START){state=S.PLAYING;initGame();bvy=LAUNCH_VY;bOnPad=false;flipAlpha=1;return;}
  if(state===S.OVER){if(overPause>0)return;state=S.START;return;}
  if(state===S.PLAYING){
    if(!flipShown){flipShown=true;flipAlpha=1;}
    bside*=-1;
    bvx+=FLIP_IMPULSE*bside;
    emitFlip(bx,by,hue);
  }
}
canvas.addEventListener('pointerdown',function(e){
  e.preventDefault();
  // check share btn
  if(state===S.OVER && overPause<=0){
    const r=canvas.getBoundingClientRect();
    const mx=((e.clientX-r.left)/r.width)*VW;
    const my=((e.clientY-r.top)/r.height)*VH;
    const sb=shareRect();
    if(mx>=sb.x&&mx<=sb.x+sb.w&&my>=sb.y&&my<=sb.y+sb.h){doShare();return;}
  }
  doInput();
});
document.addEventListener('keydown',function(e){
  if(e.code==='Space'||e.code==='Enter'){e.preventDefault();doInput();}
});

// ============ SHARE ============
function shareRect(){return{x:VW/2-82,y:VH*0.77-18,w:164,h:36};}
function doShare(){
  const url='https://balinti.github.io/neon-bounce/?challenge='+score;
  const txt='I scored '+score+' in Neon Bounce! Can you beat me? '+url;
  if(navigator.share){navigator.share({title:'Neon Bounce',text:txt,url:url}).catch(function(){});}
  else if(navigator.clipboard){navigator.clipboard.writeText(url).then(function(){shareFeedback=2;}).catch(function(){});}
}

// ============ COLLISION ============
function checkPads(){
  if(bvy<0) return;
  for(let i=0;i<pads.length;i++){
    const p=pads[i];
    const pt=p.y, pl=p.x, pr=p.x+p.w;
    if(bx+BALL_R>pl && bx-BALL_R<pr){
      if(by+BALL_R>=pt && by+BALL_R<=pt+p.h+12){
        // land
        by=pt-BALL_R;
        bvy=LAUNCH_VY;
        bvx*=0.25;
        bOnPad=true;

        const ph=(hue+p.side*30+360)%360;
        emitSparks(bx,pt,10,ph);

        if(!p.scored){
          p.scored=true;
          const cx=p.x+p.w/2;
          const dist=Math.abs(bx-cx);
          const pz=p.w*PERFECT_FRAC*0.5;
          if(dist<pz){
            p.perfect=true;combo++;
            multi=Math.min(1+Math.floor(combo/3),5);
            score+=2*multi;
            saveCharge=Math.min(saveCharge+0.34,1);
            emitPerfect(bx,pt,ph);
            shake(5,0.18);
          }else{
            combo=0;multi=1;score+=1;
          }
        }
        return;
      }
    }
  }
}

function checkGates(){
  for(let i=0;i<gates.length;i++){
    const g=gates[i];
    if(bx+BALL_R>g.x && bx-BALL_R<g.x+g.w && by+BALL_R>g.y && by-BALL_R<g.y+g.h) return true;
  }
  return false;
}

// ============ GAME OVER ============
function gameOver(){
  state=S.OVER;overPause=RESULTS_PAUSE;
  if(score>best){best=score;try{localStorage.setItem(LS_KEY,''+best)}catch(e){}}
  shake(14,0.45);
  emitDeath(bx,by,hue);
}

// ============ UPDATE ============
function update(dt){
  if(state!==S.PLAYING) return;
  dt=Math.min(dt,0.035);
  gameTime+=dt;
  hue=(260+gameTime*14)%360;

  // neon save
  if(saveOn){
    saveTimer-=dt;
    if(saveTimer<=0){saveOn=false;savePad=null;}
    else if(savePad){
      const tx=savePad.x+savePad.w/2, ty=savePad.y-BALL_R;
      const dx=tx-bx, dy=ty-by;
      const d=Math.sqrt(dx*dx+dy*dy);
      if(d>4){bvx=(dx/d)*SAVE_SNAP_SPD;bvy=(dy/d)*SAVE_SNAP_SPD*0.65;}
      dt*=0.35;
    }
  }

  // physics
  bvy+=GRAVITY_Y*dt;
  bvx+=SIDE_GRAV*bside*dt;
  bvx*=(1-2.8*dt);
  bx+=bvx*dt;
  by+=bvy*dt;

  // walls
  if(bx-BALL_R<WALL_L){bx=WALL_L+BALL_R;bvx=Math.abs(bvx)*0.25;}
  if(bx+BALL_R>wallR()){bx=wallR()-BALL_R;bvx=-Math.abs(bvx)*0.25;}

  // move pads
  for(let i=0;i<pads.length;i++){
    const p=pads[i];
    if(p.moving) p.y=p.baseY+Math.sin(gameTime*p.mSpd*0.05)*p.mRange*p.mDir;
  }

  // collisions
  checkPads();
  if(checkGates()){gameOver();return;}

  // camera
  updateCam();

  // despawn
  const bot=-cameraY+VH+120;
  for(let i=pads.length-1;i>=0;i--) if(pads[i].y>bot) pads.splice(i,1);
  for(let i=gates.length-1;i>=0;i--) if(gates[i].y>bot) gates.splice(i,1);

  // spawn
  const top=-cameraY-250;
  while(nextPadY>top) spawnNext();

  // fall death
  if(by>-cameraY+VH+60){
    if(saveCharge>=1&&!saveOn){if(trySave())return;}
    gameOver();return;
  }

  // trail
  trail.push({x:bx,y:by,a:1});
  if(trail.length>TRAIL_MAX) trail.shift();
  for(let i=0;i<trail.length;i++) trail[i].a-=dt*3.5;

  updateShake(dt);

  // particles
  for(let i=0;i<pool.length;i++){
    const p=pool[i];
    if(!p.active) continue;
    p.life-=dt;
    if(p.life<=0){p.active=false;continue;}
    p.x+=p.vx*dt;p.y+=p.vy*dt;
    if(p.tp===0) p.vy+=280*dt;
    if(p.tp===1) p.sz+=190*dt;
  }

  // flip overlay fade
  if(flipAlpha>0){flipAlpha-=dt*2.2;if(flipAlpha<0)flipAlpha=0;}
}

// ============ DRAWING ============
function drawBg(){
  const bh=(hue+180)%360;
  const g=ctx.createLinearGradient(0,0,0,VH);
  g.addColorStop(0,'hsl('+bh+',35%,4%)');
  g.addColorStop(1,'hsl('+((bh+35)%360)+',45%,7%)');
  ctx.fillStyle=g;ctx.fillRect(0,0,VW,VH);

  // grid
  ctx.strokeStyle='hsla('+bh+',25%,18%,0.07)';ctx.lineWidth=1;
  const gs=42,oy=(cameraY%gs+gs)%gs;
  for(let y=-gs+oy;y<VH+gs;y+=gs){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(VW,y);ctx.stroke();}
  for(let x=0;x<VW;x+=gs){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,VH);ctx.stroke();}
}

function drawWalls(){
  const wh=(hue+55)%360;
  ctx.fillStyle='hsla('+wh+',50%,25%,0.25)';
  ctx.fillRect(0,0,WALL_L,VH);
  ctx.fillStyle='hsla('+wh+',70%,48%,0.55)';
  ctx.fillRect(WALL_L-2,0,2,VH);

  ctx.fillStyle='hsla('+wh+',50%,25%,0.25)';
  ctx.fillRect(wallR(),0,VW-wallR(),VH);
  ctx.fillStyle='hsla('+wh+',70%,48%,0.55)';
  ctx.fillRect(wallR(),0,2,VH);
}

function drawPad(p){
  const py=p.y+cameraY;
  if(py<-60||py>VH+60) return;
  const ph=(hue+p.side*30+360)%360;
  const sat=p.perfect?'100%':'68%';
  const lit=p.perfect?'68%':'50%';

  // glow
  ctx.fillStyle='hsla('+ph+',70%,48%,0.12)';
  ctx.fillRect(p.x-5,py-5,p.w+10,p.h+10);

  // body
  ctx.fillStyle='hsl('+ph+','+sat+','+lit+')';
  ctx.fillRect(p.x,py,p.w,p.h);

  // perfect zone
  const zw=p.w*PERFECT_FRAC, zx=p.x+(p.w-zw)/2;
  ctx.fillStyle='hsla('+ph+',100%,88%,0.55)';
  ctx.fillRect(zx,py+2,zw,p.h-4);

  // border
  ctx.strokeStyle='hsla('+ph+',85%,68%,0.7)';
  ctx.lineWidth=1.5;ctx.strokeRect(p.x,py,p.w,p.h);
}

function drawGate(g){
  const gy=g.y+cameraY;
  if(gy<-120||gy>VH+60) return;
  const gh=(hue+115)%360;
  ctx.fillStyle='hsla('+gh+',85%,58%,0.65)';
  ctx.fillRect(g.x,gy,g.w,g.h);
  ctx.fillStyle='hsla('+gh+',100%,78%,0.22)';
  ctx.fillRect(g.x-3,gy-3,g.w+6,g.h+6);
}

function drawBall(){
  const bby=by+cameraY;

  // trail
  for(let i=0;i<trail.length;i++){
    const t=trail[i];
    const a=Math.max(0,t.a*0.45);
    if(a<=0) continue;
    const ty=t.y+cameraY;
    const r=BALL_R*(i/trail.length)*0.65;
    ctx.beginPath();ctx.arc(t.x,ty,r,0,Math.PI*2);
    ctx.fillStyle='hsla('+hue+',100%,68%,'+a+')';ctx.fill();
  }

  // glow
  ctx.beginPath();ctx.arc(bx,bby,BALL_R+9,0,Math.PI*2);
  ctx.fillStyle='hsla('+hue+',100%,58%,0.18)';ctx.fill();

  // ball
  ctx.beginPath();ctx.arc(bx,bby,BALL_R,0,Math.PI*2);
  ctx.fillStyle='hsl('+hue+',100%,80%)';ctx.fill();

  // highlight
  ctx.beginPath();ctx.arc(bx-2,bby-2,BALL_R*0.38,0,Math.PI*2);
  ctx.fillStyle='hsla('+hue+',100%,95%,0.65)';ctx.fill();

  // side arrow
  const ax=bx+bside*20;
  ctx.beginPath();ctx.moveTo(ax,bby-5);ctx.lineTo(ax+bside*9,bby);ctx.lineTo(ax,bby+5);
  ctx.fillStyle='hsla('+hue+',100%,80%,0.45)';ctx.fill();
}

function drawParticles(){
  for(let i=0;i<pool.length;i++){
    const p=pool[i];
    if(!p.active) continue;
    const a=p.life/p.ml;
    const py=p.y+cameraY;
    if(p.tp===1){
      ctx.beginPath();ctx.arc(p.x,py,p.sz,0,Math.PI*2);
      ctx.strokeStyle='hsla('+p.h+',100%,68%,'+a*0.45+')';
      ctx.lineWidth=2.5;ctx.stroke();
    }else{
      ctx.fillStyle='hsla('+p.h+',100%,68%,'+a+')';
      ctx.fillRect(p.x-p.sz/2,py-p.sz/2,p.sz,p.sz);
    }
  }
}

function drawUI(){
  if(state===S.PLAYING||state===S.OVER){
    ctx.textAlign='center';ctx.textBaseline='top';

    // score glow
    ctx.fillStyle='hsla('+hue+',100%,68%,0.25)';
    ctx.font='bold 50px "Segoe UI",system-ui,sans-serif';
    ctx.fillText(score,VW/2,18);
    ctx.fillStyle='#fff';
    ctx.fillText(score,VW/2,16);

    // combo
    if(multi>1){
      ctx.font='bold 20px "Segoe UI",system-ui,sans-serif';
      ctx.fillStyle='hsl('+((hue+55)%360)+',100%,74%)';
      ctx.fillText('x'+multi+' COMBO '+combo,VW/2,72);
    }

    // save bar
    if(saveCharge>0||saveOn){
      const bw=82,bh=7,bx2=VW/2-bw/2,by2=multi>1?98:74;
      ctx.fillStyle='rgba(255,255,255,0.12)';
      ctx.fillRect(bx2,by2,bw,bh);
      const sh=saveCharge>=1?(hue+115)%360:hue;
      const sl=saveCharge>=1?'78%':'52%';
      ctx.fillStyle='hsl('+sh+',88%,'+sl+')';
      ctx.fillRect(bx2,by2,bw*saveCharge,bh);
      ctx.font='10px "Segoe UI",system-ui,sans-serif';
      ctx.fillStyle='hsla(0,0%,100%,0.4)';
      ctx.fillText('NEON SAVE',VW/2,by2+11);
    }

    // challenge target
    if(challengeScore>0){
      ctx.font='bold 14px "Segoe UI",system-ui,sans-serif';
      ctx.fillStyle='hsla(48,100%,68%,0.75)';
      ctx.fillText(score>=challengeScore?'CHALLENGE BEATEN!':'BEAT: '+challengeScore,VW/2,VH-28);
    }
  }

  // flip overlay
  if(state===S.PLAYING && !flipShown && flipAlpha>0){
    ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.font='bold 28px "Segoe UI",system-ui,sans-serif';
    ctx.fillStyle='rgba(255,255,255,'+(flipAlpha*0.8)+')';
    ctx.fillText('TAP TO FLIP',VW/2,VH*0.38);
  }

  // save active
  if(saveOn){
    ctx.textAlign='center';
    ctx.font='bold 24px "Segoe UI",system-ui,sans-serif';
    ctx.fillStyle='hsla('+((hue+115)%360)+',100%,78%,'+(0.5+Math.sin(gameTime*18)*0.3)+')';
    ctx.fillText('NEON SAVE!',VW/2,VH*0.28);
  }
}

function drawStart(){
  drawBg();drawWalls();
  ctx.textAlign='center';ctx.textBaseline='middle';
  const th=(Date.now()*0.03)%360;

  // title
  ctx.font='bold 54px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='hsla('+th+',100%,58%,0.25)';
  ctx.fillText('NEON',VW/2+2,VH*0.28+2);
  ctx.fillStyle='hsl('+th+',100%,80%)';
  ctx.fillText('NEON',VW/2,VH*0.28);

  ctx.font='bold 48px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='hsla('+((th+38)%360)+',100%,58%,0.25)';
  ctx.fillText('BOUNCE',VW/2+2,VH*0.28+58);
  ctx.fillStyle='hsl('+((th+38)%360)+',100%,80%)';
  ctx.fillText('BOUNCE',VW/2,VH*0.28+56);

  ctx.font='15px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='hsla('+th+',55%,68%,0.6)';
  ctx.fillText('FLIP BOUNCE',VW/2,VH*0.28+96);

  const p=0.55+Math.sin(Date.now()*0.004)*0.4;
  ctx.font='bold 22px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='rgba(255,255,255,'+p+')';
  ctx.fillText('Tap to Start',VW/2,VH*0.56);

  if(best>0){
    ctx.font='16px "Segoe UI",system-ui,sans-serif';
    ctx.fillStyle='rgba(255,255,255,0.45)';
    ctx.fillText('Best: '+best,VW/2,VH*0.64);
  }

  if(challengeScore>0){
    ctx.font='bold 17px "Segoe UI",system-ui,sans-serif';
    ctx.fillStyle='hsla(48,100%,68%,0.85)';
    ctx.fillText('Challenge: Beat '+challengeScore+'!',VW/2,VH*0.72);
  }

  ctx.font='12px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='rgba(255,255,255,0.28)';
  ctx.fillText('Tap / Space / Enter to flip',VW/2,VH*0.87);
}

function drawOver(){
  ctx.fillStyle='rgba(0,0,0,0.52)';ctx.fillRect(0,0,VW,VH);
  ctx.textAlign='center';ctx.textBaseline='middle';

  ctx.font='bold 42px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='hsl('+hue+',78%,62%)';
  ctx.fillText('GAME OVER',VW/2,VH*0.26);

  ctx.font='bold 62px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='#fff';
  ctx.fillText(score,VW/2,VH*0.39);

  ctx.font='18px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='rgba(255,255,255,0.55)';
  ctx.fillText('Best: '+best,VW/2,VH*0.48);

  if(score===best&&score>0){
    ctx.font='bold 20px "Segoe UI",system-ui,sans-serif';
    ctx.fillStyle='hsl(48,100%,68%)';
    ctx.fillText('NEW BEST!',VW/2,VH*0.54);
  }

  if(challengeScore>0){
    ctx.font='bold 16px "Segoe UI",system-ui,sans-serif';
    ctx.fillStyle=score>=challengeScore?'hsl(120,100%,68%)':'hsl(0,78%,62%)';
    ctx.fillText(score>=challengeScore?'CHALLENGE BEATEN!':'Needed: '+challengeScore,VW/2,VH*0.60);
  }

  // retry
  const rp=0.45+Math.sin(Date.now()*0.004)*0.35;
  ctx.font='bold 20px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='rgba(255,255,255,'+(overPause>0?0.18:rp)+')';
  ctx.fillText('Tap to Retry',VW/2,VH*0.70);

  // share btn
  const sb=shareRect();
  ctx.fillStyle='hsla('+hue+',65%,48%,'+(overPause>0?0.25:0.75)+')';
  roundRect(sb.x,sb.y,sb.w,sb.h,9);ctx.fill();
  ctx.font='bold 14px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle='rgba(255,255,255,'+(overPause>0?0.3:0.9)+')';
  ctx.fillText(shareFeedback>0?'Link Copied!':'Challenge a Friend',VW/2,sb.y+sb.h/2);
}

function roundRect(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();
}

// ============ RENDER ============
function render(){
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const sx=canvas.width/VW, sy=canvas.height/VH;
  ctx.setTransform(sx,0,0,sy,0,0);

  if(state===S.START){drawStart();return;}

  ctx.save();ctx.translate(shakeX,shakeY);
  drawBg();drawWalls();
  for(let i=0;i<pads.length;i++) drawPad(pads[i]);
  for(let i=0;i<gates.length;i++) drawGate(gates[i]);
  drawParticles();
  drawBall();
  ctx.restore();

  drawUI();
  if(state===S.OVER) drawOver();
}

// ============ LOOP ============
let lastT=0;
function loop(ts){
  const dt=lastT?(ts-lastT)/1000:0.016;
  lastT=ts;
  if(state===S.OVER){
    if(overPause>0)overPause-=dt;
    if(shareFeedback>0)shareFeedback-=dt;
    updateShake(dt);
    // keep particles alive
    for(let i=0;i<pool.length;i++){
      const p=pool[i];if(!p.active)continue;
      p.life-=dt;if(p.life<=0){p.active=false;continue;}
      p.x+=p.vx*dt;p.y+=p.vy*dt;
      if(p.tp===0)p.vy+=280*dt;if(p.tp===1)p.sz+=190*dt;
    }
  }
  update(dt);
  render();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

})();
</script>
</body>
</html>