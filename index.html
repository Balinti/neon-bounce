<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Neon Bounce - Free HTML5 Game</title>
<meta name="description" content="Neon Bounce: Flip & Perfect – a hyper-casual HTML5 game. Tap to bounce and flip between lanes, land perfect combos, build multipliers, and chase high scores. Free, no install, plays in any browser.">
<meta name="theme-color" content="#0a0014">
<link rel="canonical" href="https://balinti.github.io/neon-bounce/">
<meta property="og:type" content="website">
<meta property="og:title" content="Neon Bounce - Free HTML5 Game">
<meta property="og:description" content="Tap to bounce and flip between lanes. Land perfect combos, build multipliers, and chase high scores in this free hyper-casual HTML5 game.">
<meta property="og:url" content="https://balinti.github.io/neon-bounce/">
<meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%230a0014'/%3E%3Cstop offset='100%25' stop-color='%23120028'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23bg)'/%3E%3Ccircle cx='600' cy='260' r='40' fill='%2300ffcc'/%3E%3Crect x='350' y='340' width='500' height='12' rx='6' fill='%23ff00ff' opacity='0.8'/%3E%3Crect x='400' y='420' width='400' height='12' rx='6' fill='%2300ccff' opacity='0.6'/%3E%3Crect x='300' y='500' width='600' height='12' rx='6' fill='%23ffcc00' opacity='0.5'/%3E%3Ctext x='600' y='180' text-anchor='middle' font-family='sans-serif' font-size='64' font-weight='bold' fill='%2300ffcc'%3ENeon Bounce%3C/text%3E%3C/svg%3E">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Neon Bounce - Free HTML5 Game">
<meta name="twitter:description" content="Tap to bounce and flip between lanes. Land perfect combos, build multipliers, and chase high scores.">
<meta name="twitter:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%230a0014'/%3E%3Cstop offset='100%25' stop-color='%23120028'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23bg)'/%3E%3Ccircle cx='600' cy='260' r='40' fill='%2300ffcc'/%3E%3Ctext x='600' y='180' text-anchor='middle' font-family='sans-serif' font-size='64' font-weight='bold' fill='%2300ffcc'%3ENeon Bounce%3C/text%3E%3C/svg%3E">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0a0014;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;color:#fff;touch-action:none;-webkit-tap-highlight-color:transparent;user-select:none}
#app{position:relative;width:100%;max-width:420px;height:100vh;height:100dvh;max-height:750px;margin:0 auto;overflow:hidden}
#c{display:block;width:100%;height:100%}
#ui{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;display:flex;align-items:center;justify-content:center}
.panel{pointer-events:auto;text-align:center;padding:30px 20px;border-radius:16px;background:rgba(10,0,20,0.88);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border:1px solid rgba(0,255,200,0.15);max-width:320px;width:90%;display:none;flex-direction:column;align-items:center;gap:10px}
.panel.active{display:flex}
.panel h1{font-size:2.2em;background:linear-gradient(135deg,#0fc,#f0f,#0cf);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px;line-height:1.1}
.panel h2{font-size:1.5em;color:#0fc;margin-bottom:4px}
.panel .sub{font-size:0.85em;color:rgba(255,255,255,0.5);margin-bottom:8px}
.panel .score-big{font-size:3em;font-weight:bold;color:#fff;line-height:1.1}
.panel .score-best{font-size:1em;color:rgba(255,255,255,0.6)}
.panel .highlights{font-size:0.8em;color:rgba(255,255,255,0.45);line-height:1.6}
.panel .cta{font-size:1.1em;color:#0fc;margin-top:8px;animation:pulse 1.8s ease-in-out infinite}
.panel .hint{font-size:0.75em;color:rgba(255,255,255,0.35)}
.panel .challenge-banner{font-size:0.9em;color:#f0f;padding:6px 12px;border:1px solid rgba(255,0,255,0.3);border-radius:8px;margin-bottom:4px}
.share-btn{pointer-events:auto;background:linear-gradient(135deg,rgba(0,255,200,0.15),rgba(255,0,255,0.15));border:1px solid rgba(0,255,200,0.3);color:#0fc;padding:8px 18px;border-radius:8px;font-size:0.85em;cursor:pointer;margin-top:4px;transition:background 0.2s}
.share-btn:active{background:rgba(0,255,200,0.25)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
#seo-details{max-width:420px;margin:8px auto 0;text-align:center}
#seo-details summary{color:rgba(255,255,255,0.3);font-size:0.7em;cursor:pointer}
#seo-details p{color:rgba(255,255,255,0.2);font-size:0.65em;padding:8px 16px;line-height:1.5}
</style>
</head>
<body>
<div id="app">
<canvas id="c"></canvas>
<div id="ui">
<div id="startPanel" class="panel active">
<h1>Neon Bounce</h1>
<div class="sub">Flip &amp; Perfect</div>
<div id="challengeBanner" class="challenge-banner" style="display:none"></div>
<div class="cta">Tap to Start</div>
<div class="hint">One tap = Bounce + Flip lane</div>
</div>
<div id="overPanel" class="panel">
<h2>Game Over</h2>
<div id="finalScore" class="score-big">0</div>
<div id="bestScore" class="score-best">Best: 0</div>
<div id="runHighlights" class="highlights"></div>
<div class="cta">Tap to Retry</div>
<button id="shareBtn" class="share-btn">Challenge a Friend</button>
</div>
</div>
</div>
<details id="seo-details">
<summary>About Neon Bounce</summary>
<p>Neon Bounce: Flip &amp; Perfect is a free hyper-casual HTML5 game. Tap to bounce between three neon lanes, land perfect combos to build multipliers, and earn Void Dash charges for clutch saves. Features increasing difficulty with moving, breaking, and blinking platforms. No download required &ndash; plays instantly in any modern browser on mobile or desktop.</p>
</details>
<script>
'use strict';
(function(){

/* ── Canvas & DPR ── */
var canvas = document.getElementById('c');
var ctx = canvas.getContext('2d', { alpha: false });
var app = document.getElementById('app');
var W, H, dpr;

function resize() {
  var r = app.getBoundingClientRect();
  dpr = Math.min(window.devicePixelRatio || 1, 2);
  W = r.width;
  H = r.height;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener('resize', resize);
resize();

/* ── UI refs ── */
var startPanel = document.getElementById('startPanel');
var overPanel = document.getElementById('overPanel');
var finalScoreEl = document.getElementById('finalScore');
var bestScoreEl = document.getElementById('bestScore');
var runHighlightsEl = document.getElementById('runHighlights');
var shareBtn = document.getElementById('shareBtn');
var challengeBanner = document.getElementById('challengeBanner');

/* ── Challenge param ── */
var urlParams = new URLSearchParams(window.location.search);
var challengeScore = parseInt(urlParams.get('challenge')) || 0;
if (challengeScore > 0) {
  challengeBanner.textContent = 'Challenge: Beat ' + challengeScore;
  challengeBanner.style.display = 'block';
}

/* ── localStorage ── */
var LS_KEY = 'neonBounce_bestScore';
var bestScore = parseInt(localStorage.getItem(LS_KEY)) || 0;

/* ── Game state machine ── */
var STATE_START = 0, STATE_PLAYING = 1, STATE_OVER = 2;
var state = STATE_START;

/* ── Constants ── */
var BALL_R = 10;
var PLAT_H = 8;
var GRAVITY = 1400;
var BOUNCE_VEL = -520;
var LANE_COUNT = 3;
var LANE_PAD = 24;

function laneX(lane) {
  var usable = W - LANE_PAD * 2;
  return LANE_PAD + usable * (lane + 0.5) / LANE_COUNT;
}

/* ── Object pools ── */
var player = {};
var platforms = [];
var particles = [];
var rings = [];
var trails = [];

/* ── Run state ── */
var score, mult, perfectStreak, perfectTotal, maxMult, maxStreak;
var dashCharges, dashUsed, totalDashEarned;
var scrollSpeed, spawnCursor, gameTime;
var shakeX, shakeY, shakeDur;
var dashInvuln, dashFlashTime;
var vignetteAlpha;
var lastTime;

/* ── Platform width/gap by score ── */
function platWidth() {
  var w0 = W * 0.42;
  var wMin = W * 0.28;
  return Math.max(w0 - 0.65 * score, wMin);
}
function platGap() {
  return Math.min(118 + 0.55 * score, 170);
}

/* ── Platform type selection by score bands ── */
function pickType() {
  var s = score;
  var r = Math.random();
  if (s < 10) return 'static';
  if (s < 30) return r < 0.7 ? 'static' : 'moving';
  if (s < 60) {
    if (r < 0.55) return 'static';
    if (r < 0.80) return 'moving';
    return 'break';
  }
  if (r < 0.40) return 'static';
  if (r < 0.65) return 'moving';
  if (r < 0.85) return 'break';
  return 'blink';
}

/* ── Platform factory ── */
function makePlatform(lane, y, type, w) {
  return {
    x: laneX(lane),
    y: y,
    w: w,
    lane: lane,
    type: type,
    alive: true,
    breakTimer: -1,
    blinkPhase: Math.random() * Math.PI * 2,
    movePhase: Math.random() * Math.PI * 2,
    moveAmp: type === 'moving' ? Math.min(18 + 0.08 * score, 34) : 0,
    visible: true,
    landed: false
  };
}

/* ── Spawn a row of platforms at spawnCursor ── */
function spawnRow() {
  spawnCursor -= platGap();
  var s = score;
  var w = platWidth();
  var lanes = [];

  if (s >= 30 && Math.random() < 0.20) {
    /* 2 platforms in different lanes */
    var a = Math.floor(Math.random() * 3);
    var b = (a + 1 + Math.floor(Math.random() * 2)) % 3;
    lanes.push(a, b);
  } else {
    var lane;
    if (s >= 60 && Math.random() < 0.12) {
      /* Skip the expected next lane */
      var expected = (player.lane + 1) % 3;
      var options = [];
      for (var li = 0; li < 3; li++) { if (li !== expected) options.push(li); }
      lane = options[Math.floor(Math.random() * options.length)];
    } else {
      lane = Math.floor(Math.random() * 3);
    }
    lanes.push(lane);
  }

  for (var i = 0; i < lanes.length; i++) {
    platforms.push(makePlatform(lanes[i], spawnCursor, pickType(), w));
  }
}

/* ── Particles ── */
function spawnParticles(x, y, count, hue, speed) {
  for (var i = 0; i < count; i++) {
    var angle = Math.random() * Math.PI * 2;
    var spd = (0.3 + Math.random() * 0.7) * speed;
    var life = 0.5 + Math.random() * 0.4;
    particles.push({
      x: x, y: y,
      vx: Math.cos(angle) * spd,
      vy: Math.sin(angle) * spd - 60,
      life: life, maxLife: life,
      hue: hue + Math.random() * 30 - 15,
      size: 2 + Math.random() * 3
    });
  }
}

function spawnRing(x, y, hue) {
  rings.push({ x: x, y: y, r: 5, maxR: 50, life: 0.4, maxLife: 0.4, hue: hue });
}

/* ── Screen shake ── */
function triggerShake(intensity, duration) {
  shakeDur = duration;
  shakeX = (Math.random() - 0.5) * intensity;
  shakeY = (Math.random() - 0.5) * intensity;
}

/* ── HSL cycling ── */
function hslCycle(t, m) {
  return ((180 + t * 40 + m * 20) % 360) | 0;
}

/* ── Init game ── */
function initGame() {
  score = 0; mult = 1;
  perfectStreak = 0; perfectTotal = 0;
  maxMult = 1; maxStreak = 0;
  dashCharges = 0; dashUsed = false; totalDashEarned = 0;
  scrollSpeed = 220;
  gameTime = 0;
  shakeX = 0; shakeY = 0; shakeDur = 0;
  dashInvuln = 0; dashFlashTime = 0; vignetteAlpha = 0;
  particles.length = 0; rings.length = 0; trails.length = 0; platforms.length = 0;

  player.x = laneX(1);
  player.y = H * 0.35;
  player.vy = 0;
  player.lane = 1;
  player.prevY = player.y;
  player.onPlatform = false;

  /* Starting platform */
  spawnCursor = H * 0.55;
  platforms.push(makePlatform(1, H * 0.45, 'static', W * 0.42));

  /* Fill screen */
  while (spawnCursor > -100) {
    spawnRow();
  }
}

/* ── Input ── */
var inputQueued = false;

function handleInput(e) {
  if (e) e.preventDefault();
  if (state === STATE_START) {
    state = STATE_PLAYING;
    startPanel.classList.remove('active');
    initGame();
    lastTime = performance.now();
    requestAnimationFrame(gameLoop);
    return;
  }
  if (state === STATE_OVER) {
    state = STATE_START;
    overPanel.classList.remove('active');
    startPanel.classList.add('active');
    return;
  }
  if (state === STATE_PLAYING) {
    inputQueued = true;
  }
}

canvas.addEventListener('pointerdown', handleInput);
app.addEventListener('pointerdown', function(e) {
  if (e.target === canvas || e.target === app) handleInput(e);
});
document.addEventListener('keydown', function(e) {
  if (e.code === 'Space' || e.code === 'Enter') {
    e.preventDefault();
    handleInput(null);
  }
});

/* ── Share button ── */
shareBtn.addEventListener('pointerdown', function(e) { e.stopPropagation(); });
shareBtn.addEventListener('click', function(e) {
  e.stopPropagation();
  var url = 'https://balinti.github.io/neon-bounce/?challenge=' + score;
  var text = 'I scored ' + score + ' in Neon Bounce! Can you beat me?';
  if (navigator.share) {
    navigator.share({ title: 'Neon Bounce Challenge', text: text, url: url }).catch(function(){});
  } else if (navigator.clipboard) {
    navigator.clipboard.writeText(text + ' ' + url).then(function() {
      shareBtn.textContent = 'Link Copied!';
      setTimeout(function() { shareBtn.textContent = 'Challenge a Friend'; }, 2000);
    }).catch(function(){});
  }
});

/* ── Rounded rect helper: cx=centerX, y=top, hw=halfWidth, h=fullHeight, r=cornerRadius ── */
function drawRoundRect(cx, y, hw, h, r) {
  var x0 = cx - hw, x1 = cx + hw, y0 = y, y1 = y + h;
  ctx.beginPath();
  ctx.moveTo(x0 + r, y0);
  ctx.lineTo(x1 - r, y0);
  ctx.arcTo(x1, y0, x1, y0 + r, r);
  ctx.lineTo(x1, y1 - r);
  ctx.arcTo(x1, y1, x1 - r, y1, r);
  ctx.lineTo(x0 + r, y1);
  ctx.arcTo(x0, y1, x0, y1 - r, r);
  ctx.lineTo(x0, y0 + r);
  ctx.arcTo(x0, y0, x0 + r, y0, r);
  ctx.closePath();
}

/* ── Main game loop ── */
function gameLoop(now) {
  if (state !== STATE_PLAYING) return;
  var dt = (now - lastTime) / 1000;
  lastTime = now;
  dt = Math.min(dt, 1 / 30);
  gameTime += dt;

  update(dt);
  render();
  requestAnimationFrame(gameLoop);
}

/* ── Update ── */
function update(dt) {
  scrollSpeed = Math.min(220 + 6.2 * score, 820);

  /* Process queued input */
  if (inputQueued) {
    inputQueued = false;
    player.vy = BOUNCE_VEL;
    player.lane = (player.lane + 1) % LANE_COUNT;
    player.onPlatform = false;
  }

  /* Gravity */
  player.vy += GRAVITY * dt;

  /* Smooth lane transition */
  var targetX = laneX(player.lane);
  var dxl = targetX - player.x;
  var laneSpeed = 1200;
  if (Math.abs(dxl) < laneSpeed * dt) {
    player.x = targetX;
  } else {
    player.x += (dxl > 0 ? 1 : -1) * laneSpeed * dt;
  }

  /* Store prev for swept collision */
  player.prevY = player.y;
  player.y += player.vy * dt;

  /* Trail */
  if (trails.length < 35) {
    trails.push({ x: player.x, y: player.y, life: 0.2, maxLife: 0.2, hue: hslCycle(gameTime, mult) });
  }

  /* Scroll platforms down */
  var sd = scrollSpeed * dt;
  for (var i = 0; i < platforms.length; i++) {
    platforms[i].y += sd;
  }
  spawnCursor += sd;

  /* Spawn new rows above */
  while (spawnCursor > -50) {
    spawnRow();
  }

  /* Update platform types */
  for (var i = 0; i < platforms.length; i++) {
    var p = platforms[i];
    if (p.type === 'moving') {
      p.x = laneX(p.lane) + Math.sin(p.movePhase + gameTime * 2 * Math.PI * 1.2) * p.moveAmp;
    }
    if (p.type === 'blink') {
      var bphase = ((gameTime * 1.111 + p.blinkPhase) % 0.9);
      p.visible = bphase < 0.62;
    } else {
      p.visible = true;
    }
    if (p.type === 'break' && p.breakTimer > 0) {
      p.breakTimer -= dt;
      if (p.breakTimer <= 0) p.alive = false;
    }
  }

  /* Dash invuln */
  if (dashInvuln > 0) dashInvuln -= dt;
  if (dashFlashTime > 0) dashFlashTime -= dt;
  if (vignetteAlpha > 0) vignetteAlpha = Math.max(0, vignetteAlpha - dt * 2.5);

  /* Swept collision: ball bottom vs platform top */
  var ballBot = player.y + BALL_R;
  var prevBallBot = player.prevY + BALL_R;

  if (player.vy > 0 && dashInvuln <= 0) {
    for (var i = 0; i < platforms.length; i++) {
      var p = platforms[i];
      if (!p.alive || !p.visible) continue;
      var pTop = p.y;
      if (prevBallBot <= pTop && ballBot >= pTop) {
        var halfW = p.w / 2;
        if (player.x >= p.x - halfW && player.x <= p.x + halfW) {
          /* Landing! */
          player.y = pTop - BALL_R;
          player.vy = 0;
          player.onPlatform = true;

          /* Perfect zone: center 30% */
          var perfectHalf = halfW * 0.15;
          var isPerfect = Math.abs(player.x - p.x) <= perfectHalf;

          var h = hslCycle(gameTime, mult);

          if (isPerfect) {
            perfectStreak++;
            perfectTotal++;
            if (perfectStreak > maxStreak) maxStreak = perfectStreak;
            mult = Math.min(1 + Math.floor(perfectStreak / 5), 6);
            if (mult > maxMult) maxMult = mult;
            score += mult + 1;

            /* Dash charge: 1 per 10 perfectTotal, max 1 */
            var earned = Math.floor(perfectTotal / 10);
            if (earned > totalDashEarned) {
              totalDashEarned = earned;
              dashCharges = Math.min(dashCharges + 1, 1);
            }

            /* Visual: strong burst + ring */
            spawnParticles(player.x, player.y + BALL_R, 16, h, 180);
            spawnRing(player.x, player.y + BALL_R, h);
            triggerShake(4, 0.12);
          } else {
            /* Normal landing */
            score += mult;
            perfectStreak = 0;
            mult = 1;
            spawnParticles(player.x, player.y + BALL_R, 8, h, 120);
            triggerShake(2, 0.08);
          }

          /* Break platform trigger */
          if (p.type === 'break' && !p.landed) {
            p.breakTimer = 0.40;
          }
          p.landed = true;
          break;
        }
      }
    }
  }

  /* Remove off-screen / dead platforms */
  for (var i = platforms.length - 1; i >= 0; i--) {
    if (platforms[i].y > H + 60 || !platforms[i].alive) {
      platforms.splice(i, 1);
    }
  }

  /* Death / Void Dash check */
  if (player.y > H + 50) {
    if (dashCharges > 0 && dashInvuln <= 0) {
      /* Void Dash! */
      dashCharges--;
      dashUsed = true;
      player.vy = BOUNCE_VEL * 1.3;
      player.y = H - 60;
      dashInvuln = 0.45;
      dashFlashTime = 0.45;
      vignetteAlpha = 1;
      triggerShake(8, 0.25);
      spawnParticles(player.x, player.y, 24, 280, 220);
    } else {
      gameOver();
      return;
    }
  }

  /* Update particles */
  for (var i = particles.length - 1; i >= 0; i--) {
    var pp = particles[i];
    pp.x += pp.vx * dt;
    pp.y += pp.vy * dt;
    pp.vy += 300 * dt;
    pp.life -= dt;
    if (pp.life <= 0) particles.splice(i, 1);
  }

  /* Update rings */
  for (var i = rings.length - 1; i >= 0; i--) {
    var rr = rings[i];
    rr.life -= dt;
    rr.r = rr.maxR * (1 - rr.life / rr.maxLife);
    if (rr.life <= 0) rings.splice(i, 1);
  }

  /* Update trails */
  for (var i = trails.length - 1; i >= 0; i--) {
    trails[i].life -= dt;
    trails[i].y += sd;
    if (trails[i].life <= 0) trails.splice(i, 1);
  }

  /* Shake decay */
  if (shakeDur > 0) {
    shakeDur -= dt;
    shakeX *= 0.85;
    shakeY *= 0.85;
  } else {
    shakeX = 0; shakeY = 0;
  }
}

/* ── Game Over ── */
function gameOver() {
  state = STATE_OVER;
  triggerShake(14, 0.4);
  spawnParticles(player.x, player.y, 40, 0, 250);

  if (score > bestScore) {
    bestScore = score;
    localStorage.setItem(LS_KEY, String(bestScore));
  }

  finalScoreEl.textContent = String(score);
  bestScoreEl.textContent = 'Best: ' + bestScore;
  var hl = 'Perfect streak: ' + maxStreak + ' &middot; Max mult: x' + maxMult;
  if (dashUsed) hl += '<br>Void Dash used!';
  runHighlightsEl.innerHTML = hl;
  overPanel.classList.add('active');

  /* Keep rendering for particles/shake fadeout */
  lastTime = performance.now();
  requestAnimationFrame(overLoop);
}

function overLoop(now) {
  var dt = (now - lastTime) / 1000;
  lastTime = now;
  dt = Math.min(dt, 1 / 30);

  for (var i = particles.length - 1; i >= 0; i--) {
    var pp = particles[i];
    pp.x += pp.vx * dt;
    pp.y += pp.vy * dt;
    pp.vy += 300 * dt;
    pp.life -= dt;
    if (pp.life <= 0) particles.splice(i, 1);
  }
  for (var i = rings.length - 1; i >= 0; i--) {
    rings[i].life -= dt;
    rings[i].r = rings[i].maxR * (1 - rings[i].life / rings[i].maxLife);
    if (rings[i].life <= 0) rings.splice(i, 1);
  }
  if (shakeDur > 0) {
    shakeDur -= dt; shakeX *= 0.85; shakeY *= 0.85;
  } else { shakeX = 0; shakeY = 0; }

  render();
  if (state === STATE_OVER && (particles.length > 0 || shakeDur > 0)) {
    requestAnimationFrame(overLoop);
  }
}

/* ── Render ── */
function render() {
  ctx.save();
  ctx.translate(shakeX, shakeY);

  /* Background */
  var grad = ctx.createLinearGradient(0, 0, 0, H);
  grad.addColorStop(0, '#0a0014');
  grad.addColorStop(0.5, '#120028');
  grad.addColorStop(1, '#0a0018');
  ctx.fillStyle = grad;
  ctx.fillRect(-20, -20, W + 40, H + 40);

  /* Subtle lane guides */
  ctx.globalAlpha = 0.06;
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 1;
  for (var i = 0; i < LANE_COUNT; i++) {
    var lx = laneX(i);
    ctx.beginPath();
    ctx.moveTo(lx, 0);
    ctx.lineTo(lx, H);
    ctx.stroke();
  }
  ctx.globalAlpha = 1;

  /* Trails */
  for (var i = 0; i < trails.length; i++) {
    var t = trails[i];
    var ta = t.life / t.maxLife;
    ctx.globalAlpha = ta * 0.35;
    ctx.fillStyle = 'hsl(' + t.hue + ',100%,65%)';
    ctx.beginPath();
    ctx.arc(t.x, t.y, BALL_R * ta, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;

  /* Platforms */
  for (var i = 0; i < platforms.length; i++) {
    var p = platforms[i];
    if (!p.alive) continue;
    var alpha = 1;
    if (p.type === 'blink' && !p.visible) alpha = 0.12;
    if (p.type === 'break' && p.breakTimer > 0) alpha = p.breakTimer / 0.40;

    ctx.globalAlpha = alpha;
    var halfW = p.w / 2;
    var hue;
    if (p.type === 'static') hue = 170;
    else if (p.type === 'moving') hue = 280;
    else if (p.type === 'break') hue = 30;
    else hue = 50;

    /* Glow layer */
    ctx.globalAlpha = alpha * 0.15;
    ctx.fillStyle = 'hsl(' + hue + ',100%,70%)';
    drawRoundRect(p.x, p.y - 2, halfW + 3, PLAT_H + 4, 4);
    ctx.fill();

    /* Platform body */
    ctx.globalAlpha = alpha;
    ctx.fillStyle = 'hsl(' + hue + ',80%,55%)';
    drawRoundRect(p.x, p.y, halfW, PLAT_H, 4);
    ctx.fill();

    /* Perfect zone marker */
    if (p.visible && alpha > 0.5) {
      ctx.globalAlpha = alpha * 0.25;
      var pzHalf = halfW * 0.15;
      ctx.fillStyle = '#fff';
      ctx.fillRect(p.x - pzHalf, p.y + 1, pzHalf * 2, PLAT_H - 2);
    }
  }
  ctx.globalAlpha = 1;

  /* Rings */
  for (var i = 0; i < rings.length; i++) {
    var rr = rings[i];
    ctx.globalAlpha = (rr.life / rr.maxLife) * 0.5;
    ctx.strokeStyle = 'hsl(' + rr.hue + ',100%,70%)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(rr.x, rr.y, rr.r, 0, Math.PI * 2);
    ctx.stroke();
  }
  ctx.globalAlpha = 1;

  /* Particles */
  for (var i = 0; i < particles.length; i++) {
    var pp = particles[i];
    var pa = pp.life / pp.maxLife;
    ctx.globalAlpha = pa;
    ctx.fillStyle = 'hsl(' + pp.hue + ',100%,65%)';
    ctx.beginPath();
    ctx.arc(pp.x, pp.y, pp.size * pa, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;

  /* Ball */
  if (state === STATE_PLAYING || state === STATE_OVER) {
    var bHue = hslCycle(gameTime || 0, mult || 1);
    var ballAlpha = 1;
    if (dashFlashTime > 0) {
      ballAlpha = (Math.sin((gameTime || 0) * 40) > 0) ? 1 : 0.3;
    }

    /* Outer glow */
    ctx.globalAlpha = ballAlpha * 0.2;
    ctx.fillStyle = 'hsl(' + bHue + ',100%,60%)';
    ctx.beginPath();
    ctx.arc(player.x, player.y, BALL_R + 6, 0, Math.PI * 2);
    ctx.fill();

    /* Body */
    ctx.globalAlpha = ballAlpha;
    ctx.fillStyle = 'hsl(' + bHue + ',100%,70%)';
    ctx.beginPath();
    ctx.arc(player.x, player.y, BALL_R, 0, Math.PI * 2);
    ctx.fill();

    /* Core highlight */
    ctx.fillStyle = '#fff';
    ctx.globalAlpha = ballAlpha * 0.5;
    ctx.beginPath();
    ctx.arc(player.x - 2, player.y - 3, BALL_R * 0.4, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;

  /* Vignette on dash */
  if (vignetteAlpha > 0) {
    var vg = ctx.createRadialGradient(W / 2, H / 2, H * 0.2, W / 2, H / 2, H * 0.7);
    vg.addColorStop(0, 'rgba(100,0,255,0)');
    vg.addColorStop(1, 'rgba(100,0,255,' + (vignetteAlpha * 0.4).toFixed(2) + ')');
    ctx.fillStyle = vg;
    ctx.fillRect(0, 0, W, H);
  }

  /* HUD */
  if (state === STATE_PLAYING) {
    var hudHue = hslCycle(gameTime, mult);

    ctx.fillStyle = '#fff';
    ctx.font = 'bold 28px "Segoe UI",system-ui,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.fillText(String(score), W / 2, 14);

    if (mult > 1) {
      ctx.font = 'bold 16px "Segoe UI",system-ui,sans-serif';
      ctx.fillStyle = 'hsl(' + hudHue + ',100%,70%)';
      ctx.fillText('x' + mult, W / 2, 46);
    }

    if (perfectStreak > 0) {
      ctx.font = '12px "Segoe UI",system-ui,sans-serif';
      ctx.fillStyle = 'rgba(255,255,255,0.5)';
      ctx.fillText('streak ' + perfectStreak, W / 2, mult > 1 ? 66 : 46);
    }

    /* Dash ready indicator */
    if (dashCharges > 0) {
      ctx.fillStyle = 'hsl(280,100%,70%)';
      ctx.font = 'bold 11px "Segoe UI",system-ui,sans-serif';
      ctx.textAlign = 'right';
      ctx.fillText('DASH READY', W - 12, 16);
    }

    /* Lane dots at bottom */
    ctx.textAlign = 'center';
    for (var i = 0; i < LANE_COUNT; i++) {
      ctx.fillStyle = (i === player.lane) ? 'hsl(' + hudHue + ',100%,70%)' : 'rgba(255,255,255,0.15)';
      ctx.beginPath();
      ctx.arc(W / 2 - 16 + i * 16, H - 16, (i === player.lane) ? 4 : 3, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  ctx.restore();
}

/* ── Idle start-screen render loop ── */
function idleRender() {
  if (state !== STATE_START) return;
  ctx.save();

  var grad = ctx.createLinearGradient(0, 0, 0, H);
  grad.addColorStop(0, '#0a0014');
  grad.addColorStop(0.5, '#120028');
  grad.addColorStop(1, '#0a0018');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, W, H);

  var t = performance.now() / 1000;

  /* Decorative platforms */
  for (var i = 0; i < 5; i++) {
    var px = W * 0.15 + (i % 3) * W * 0.32;
    var py = H * 0.28 + i * 72 + Math.sin(t * 0.8 + i * 1.2) * 14;
    var pw = 55 + i * 12;
    var hue = (170 + i * 45) % 360;
    ctx.globalAlpha = 0.25;
    ctx.fillStyle = 'hsl(' + hue + ',70%,45%)';
    drawRoundRect(px, py, pw / 2, 8, 4);
    ctx.fill();
  }

  /* Animated ball */
  ctx.globalAlpha = 0.5;
  var bx = W / 2 + Math.sin(t * 1.5) * 30;
  var by = H * 0.22 + Math.sin(t * 2.5) * 20;
  ctx.fillStyle = 'hsl(' + ((t * 40) % 360) + ',100%,65%)';
  ctx.beginPath();
  ctx.arc(bx, by, BALL_R, 0, Math.PI * 2);
  ctx.fill();
  ctx.globalAlpha = 1;

  ctx.restore();
  requestAnimationFrame(idleRender);
}
requestAnimationFrame(idleRender);

})();
</script>
</body>
</html>